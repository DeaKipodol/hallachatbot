# 한라챗봇 기능 목록

이 문서는 한라챗봇 프로젝트에서 제공하는 주요 기능들을 설명합니다.

## 1. 대화 기능

### 1.1 일반 채팅 응답
- **엔드포인트**: `/api/chat`
- **설명**: 단순한 텍스트 기반 응답을 제공하는 기본 채팅 기능
- **담당 파일**: `api/routes.py`의 `chat` 함수

### 1.2 스트리밍 채팅 응답
- **엔드포인트**: `/api/stream-chat`
- **설명**: 실시간으로 응답이 생성되는 스트리밍 방식의 채팅
- **담당 파일**: `api/routes.py`의 `stream_chat` 함수
- **핵심 클래스**: `ChatbotStream` (`ai/chatbot/stream.py`)

### 1.3 다국어 지원
- **지원 언어**: 한국어(KOR), 영어(ENG), 베트남어(VI), 일본어(JPN), 중국어(CHN)
- **설명**: 사용자 지정 언어로 응답을 생성
- **구현 위치**: `api/routes.py`의 `stream_chat` 함수 내 `instruction_map`

## 2. 검색 증강 생성(RAG) 기능

### 2.1 규정 검색 및 답변
- **설명**: 한라대학교 학사 규정 문서를 기반으로 답변 생성
- **핵심 서비스**: `RagService` (`ai/rag/service.py`)
- **규정 판단**: `RegulationGate` (`ai/rag/gate.py`)
- **벡터 검색**: `PineconeRetriever` (`ai/rag/retriever.py`)
- **문서 조회**: `MongoChunkRepository` (`ai/rag/repository.py`)
- **컨텍스트 조립**: `ContextBuilder` (`ai/rag/RagDocumentPackage.py`)

### 2.2 문서 압축 및 요약
- **설명**: 검색된 문서를 사용자 질문과 연관성 있게 압축
- **구현 위치**: `ai/chatbot/stream.py`의 `_condense_rag_context` 메서드

## 3. 함수 호출 기능

### 3.1 웹 검색
- **함수명**: `search_internet`
- **설명**: 사용자 질문에 대한 실시간 웹 검색 수행
- **구현 위치**: `ai/functions/analyzer.py`
- **특징**: 한라대학교 사이트 우선 검색 로직 포함

### 3.2 학식 메뉴 조회
- **함수명**: `get_halla_cafeteria_menu`
- **설명**: 한라대학교 학생식당의 메뉴 정보 조회
- **구현 위치**: `ai/functions/analyzer.py`
- **특징**: 날짜와 끼니(조식/중식/석식) 지정 가능

### 3.3 함수 호출 분석 및 실행
- **클래스**: `FunctionCalling`
- **설명**: 사용자 질문 분석 후 적절한 함수 호출 결정
- **구현 위치**: `ai/functions/analyzer.py`
- **통합**: `ChatbotStream`에서 `_analyze_and_execute_functions` 메서드로 호출

## 4. 데이터 관리 기능

### 4.1 문서 로딩 및 청킹
- **설명**: 학사 규정 문서를 로드하고 의미 있는 단위로 분할
- **담당 파일**: `loding/documentLoding.py`
- **청킹 방식**: 조항 단위 (`extract_chunks_finditer`) 및 별표 단위 (`extract_star_tables`)

### 4.2 벡터 임베딩 및 업로드
- **설명**: 문서 청크를 임베딩하여 벡터 DB에 업로드
- **담당 파일**: `ai/data/vector_uploader.py` (구: `loding/vector_db_upload.py`)
- **사용 모델**: OpenAI text-embedding-3-small

### 4.3 MongoDB 관리
- **설명**: 문서 청크 저장 및 관리
- **담당 파일**: `ai/data/mongodb_client.py` (구: `loding/mongodbConnect.py`)
- **컬렉션**: `regulation_chunks` (DB: `halla_academic_db`)

## 5. 시스템 기능

### 5.1 토큰 관리
- **설명**: 대화 컨텍스트의 토큰 수를 모니터링하고 제한
- **구현 위치**: `ai/chatbot/stream.py`의 `_manage_context_window` 메서드

### 5.2 오류 처리 및 복원
- **설명**: 네트워크 오류나 API 실패 시 적절한 처리
- **구현 위치**: 각 모듈 내 try-except 블록들

### 5.3 CORS 지원
- **설명**: 크로스 오리진 요청 지원
- **구현 위치**: `main.py`의 CORSMiddleware 설정

### 5.4 디버그 로깅
- **설명**: 상세한 RAG 처리 과정 로깅
- **구현 위치**: 모든 RAG 컴포넌트에 `_dbg` 메서드 통합
- **제어**: `ChatbotStream` 생성 시 `debug=True/False` 설정