# ì±—ë´‡ ìŠ¤íŠ¸ë¦¬ë° API - í”„ë¡ íŠ¸ì—”ë“œ í†µí•© ê°€ì´ë“œ

> **ëŒ€ìƒ**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œì  
> **ì‘ì„±ì¼**: 2025-10-09  
> **ê´€ë ¨ Phase**: Phase 2-4 (stream_chat() êµ¬í˜„)

---

## ğŸ“‹ ëª©ì°¨

1. [ë°°ê²½: ì™œ JSON Lines í¬ë§·ìœ¼ë¡œ ë³€ê²½í•˜ë‚˜ìš”?](#1-ë°°ê²½-ì™œ-json-lines-í¬ë§·ìœ¼ë¡œ-ë³€ê²½í•˜ë‚˜ìš”)
2. [ì´ì „ ìƒí™© (ë³€ê²½ ì „)](#2-ì´ì „-ìƒí™©-ë³€ê²½-ì „)
3. [ìƒˆë¡œìš´ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ (ë³€ê²½ í›„)](#3-ìƒˆë¡œìš´-ìŠ¤íŠ¸ë¦¬ë°-ë°©ì‹-ë³€ê²½-í›„)
4. [í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í•´ì•¼ í•  ì¼](#4-í”„ë¡ íŠ¸ì—”ë“œì—ì„œ-í•´ì•¼-í• -ì¼)
5. [ì˜ˆì œ ì½”ë“œ](#5-ì˜ˆì œ-ì½”ë“œ)
6. [FAQ](#6-faq)

---

## 1. ë°°ê²½: ì™œ JSON Lines í¬ë§·ìœ¼ë¡œ ë³€ê²½í•˜ë‚˜ìš”?

### ğŸ¤” ë¬¸ì œ ìƒí™©

**ì§ˆë¬¸**: "ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì˜¤ëŠ” ì²­í¬ ë°ì´í„°ì™€ RAG íŒë‹¨ ê·¼ê±°/ë¬¸ì„œë¥¼ ì–´ë–»ê²Œ ë™ì‹œì— ë°›ì„ ìˆ˜ ìˆì–´?"

**ê¸°ì¡´ ë°©ì‹ì˜ í•œê³„**:
```
í˜„ì¬ â†’ OpenAI API â†’ ì„œë²„ â†’ í”„ë¡ íŠ¸
        ìˆœìˆ˜ í…ìŠ¤íŠ¸   ìˆœìˆ˜ í…ìŠ¤íŠ¸ë§Œ ì „ì†¡
                      "ì•ˆë…•í•˜ì„¸ìš” ì¡¸ì—… ê·œì •ì€..."
```

- OpenAIëŠ” **í…ìŠ¤íŠ¸ ì²­í¬ë§Œ** ë³´ë‚´ì¤Œ (ë©”íƒ€ë°ì´í„° ì—†ìŒ)
- ìš°ë¦¬ê°€ ë§Œë“  **RAG ê²°ê³¼**(ì–´ë–¤ ë¬¸ì„œ ì‚¬ìš©í–ˆëŠ”ì§€, ê·œì • ì§ˆë¬¸ì¸ì§€ ë“±)ë¥¼ í•¨ê»˜ ë³´ë‚¼ ë°©ë²•ì´ ì—†ìŒ
- **í•¨ìˆ˜ í˜¸ì¶œ ê²°ê³¼**(ì›¹ê²€ìƒ‰, í•™ì‹ ë©”ë‰´)ë„ ì „ë‹¬ ë¶ˆê°€ëŠ¥

### ğŸ’¡ í•´ê²° ë°©ë²•: JSON Lines (NDJSON) í¬ë§·

**ìƒˆë¡œìš´ ë°©ì‹**:
```
OpenAI â†’ ì„œë²„ (í…ìŠ¤íŠ¸ë§Œ ë°›ìŒ)
         â†“
       JSONìœ¼ë¡œ í¬ì¥ + ë©”íƒ€ë°ì´í„° ì¶”ê°€
         â†“
       í”„ë¡ íŠ¸ (íƒ€ì…ë³„ë¡œ ì²˜ë¦¬)
```

**í•µì‹¬ ì•„ì´ë””ì–´**:
1. OpenAIì—ì„œ ì˜¨ **í…ìŠ¤íŠ¸ ì²­í¬**ë¥¼ JSON ê°ì²´ë¡œ ê°ì‹¸ì„œ ë³´ëƒ„
2. í…ìŠ¤íŠ¸ê°€ ëë‚˜ë©´ **ë©”íƒ€ë°ì´í„°**(RAG ê²°ê³¼, í•¨ìˆ˜ í˜¸ì¶œ ë‚´ì—­)ë¥¼ ì¶”ê°€ë¡œ ì „ì†¡
3. í•œ ì¤„ì— í•˜ë‚˜ì˜ JSON ê°ì²´ (JSON Lines í¬ë§·)

---

## 2. ì´ì „ ìƒí™© (ë³€ê²½ ì „)

### ê¸°ì¡´ API ì‘ë‹µ (ë‹¨ìˆœ í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°)

```http
POST /chat
Content-Type: application/json

{
  "message": "ì¡¸ì—… ê·œì •ì„ ì•Œë ¤ì£¼ì„¸ìš”",
  "language": "KOR"
}
```

**ì‘ë‹µ** (Content-Type: `text/plain`):
```
ì•ˆë…•í•˜ì„¸ìš” ì¡¸ì—… ê·œì •ì€...
```

### ë¬¸ì œì 

1. **í…ìŠ¤íŠ¸ë§Œ** ë°›ì„ ìˆ˜ ìˆìŒ
2. RAGê°€ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ
3. ì–´ë–¤ ë¬¸ì„œë¥¼ ì°¸ì¡°í–ˆëŠ”ì§€ ì•Œ ìˆ˜ ì—†ìŒ
4. ì›¹ê²€ìƒ‰/í•™ì‹ ì¡°íšŒ ê²°ê³¼ê°€ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ë¶ˆëª…í™•
5. ë””ë²„ê¹…/ë¡œê¹… ì–´ë ¤ì›€

---

## 3. ìƒˆë¡œìš´ ìŠ¤íŠ¸ë¦¬ë° ë°©ì‹ (ë³€ê²½ í›„)

### Phase 2-4ì—ì„œ êµ¬í˜„ë  ìƒˆ API

```http
POST /chat
Content-Type: application/json

{
  "message": "ì¡¸ì—… ê·œì •ì„ ì•Œë ¤ì£¼ì„¸ìš”",
  "language": "KOR"
}
```

**ì‘ë‹µ** (Content-Type: `application/x-ndjson`):
```json
{"type":"delta","content":"ì•ˆë…•í•˜ì„¸ìš”"}
{"type":"delta","content":" ì¡¸ì—…"}
{"type":"delta","content":" ê·œì •ì€"}
{"type":"delta","content":" ..."}
{"type":"metadata","data":{"rag":{"is_regulation":true,"gate_reason":"LLM íŒë‹¨: ì¡¸ì—… ê·œì • ê´€ë ¨ ì§ˆë¬¸","context_source":"mongo","hits_count":5,"document_count":3,"preview_count":0,"chunk_ids":["673abc123..."],"has_condensed_context":true},"functions":[{"name":"search_internet","arguments":{"query":"í•œë¼ëŒ€ ì¡¸ì—… ìš”ê±´"},"output":"ê²€ìƒ‰ ê²°ê³¼...","call_id":"call_123","is_fallback":false}],"web_search_status":"ok"}}
{"type":"done"}
```

### ë©”ì‹œì§€ íƒ€ì… 3ê°€ì§€

#### 1ï¸âƒ£ `delta` - í…ìŠ¤íŠ¸ ì²­í¬ (ì‹¤ì‹œê°„)
```json
{
  "type": "delta",
  "content": "ì•ˆë…•í•˜ì„¸ìš”"
}
```
- OpenAIê°€ ë³´ë‚¸ í…ìŠ¤íŠ¸ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì „ë‹¬
- í™”ë©´ì— ë°”ë¡œ í‘œì‹œ

#### 2ï¸âƒ£ `metadata` - ë©”íƒ€ë°ì´í„° (í…ìŠ¤íŠ¸ ì™„ë£Œ í›„)
```json
{
  "type": "metadata",
  "data": {
    "rag": {
      "is_regulation": true,
      "gate_reason": "LLM íŒë‹¨: ì¡¸ì—… ê·œì • ê´€ë ¨ ì§ˆë¬¸",
      "context_source": "mongo",
      "hits_count": 5,
      "document_count": 3,
      "preview_count": 0,
      "chunk_ids": ["673abc123...", "673def456..."],
      "has_condensed_context": true
    },
    "functions": [
      {
        "name": "search_internet",
        "arguments": {"query": "í•œë¼ëŒ€ ì¡¸ì—… ìš”ê±´"},
        "output": "ê²€ìƒ‰ ê²°ê³¼: ...",
        "call_id": "call_123",
        "is_fallback": false
      }
    ],
    "web_search_status": "ok"
  }
}
```

**ë©”íƒ€ë°ì´í„° í•„ë“œ ì„¤ëª…**:

| í•„ë“œ | ì„¤ëª… |
|------|------|
| `rag.is_regulation` | ê·œì • ì§ˆë¬¸ ì—¬ë¶€ (true/false) |
| `rag.gate_reason` | ê·œì • íŒë‹¨ ê·¼ê±° (LLM ì¶”ë¡  ë˜ëŠ” í‚¤ì›Œë“œ ë§¤ì¹­) |
| `rag.context_source` | ì»¨í…ìŠ¤íŠ¸ ì¶œì²˜: `"mongo"` (DB ë³¸ë¬¸) / `"preview"` (Pinecone ë¯¸ë¦¬ë³´ê¸°) / `"none"` (ìë£Œ ì—†ìŒ) |
| `rag.hits_count` | Pinecone ê²€ìƒ‰ íˆíŠ¸ ìˆ˜ |
| `rag.document_count` | MongoDBì—ì„œ ê°€ì ¸ì˜¨ ë¬¸ì„œ ìˆ˜ |
| `rag.preview_count` | Pinecone ë¯¸ë¦¬ë³´ê¸° ì‚¬ìš© ìˆ˜ (fallback) |
| `rag.chunk_ids` | MongoDB ì²­í¬ ID ëª©ë¡ (ë””ë²„ê¹…ìš©) |
| `rag.has_condensed_context` | ìš”ì•½ëœ ì»¨í…ìŠ¤íŠ¸ ì‚¬ìš© ì—¬ë¶€ |
| `functions[]` | í˜¸ì¶œëœ í•¨ìˆ˜ ëª©ë¡ (ì›¹ê²€ìƒ‰, í•™ì‹, ê³µì§€ì‚¬í•­ ë“±) |
| `functions[].is_fallback` | ë³´ê°• í˜¸ì¶œ ì—¬ë¶€ (LLMì´ ì•„ë‹Œ ê·œì¹™ ê¸°ë°˜) |
| `web_search_status` | ì›¹ê²€ìƒ‰ ìƒíƒœ: `"ok"` / `"empty-or-error"` / `"not-run"` |

#### 3ï¸âƒ£ `done` - ì™„ë£Œ ì‹ í˜¸
```json
{
  "type": "done"
}
```
- ìŠ¤íŠ¸ë¦¬ë° ì¢…ë£Œ
- ì—°ê²° ë‹«ê¸°

---

## 4. í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í•´ì•¼ í•  ì¼

### ğŸ“Œ ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ

#### Step 1: Fetch APIë¡œ ìŠ¤íŠ¸ë¦¬ë° ìš”ì²­

```javascript
const response = await fetch('/chat', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    message: 'ì¡¸ì—… ê·œì •ì„ ì•Œë ¤ì£¼ì„¸ìš”',
    language: 'KOR'
  })
});
```

#### Step 2: ReadableStream ì½ê¸°

```javascript
const reader = response.body
  .pipeThrough(new TextDecoderStream())
  .getReader();
```

#### Step 3: í•œ ì¤„ì”© íŒŒì‹± (JSON Lines)

```javascript
let buffer = '';
let fullText = '';  // ì „ì²´ í…ìŠ¤íŠ¸ ëˆ„ì 
let metadata = null;  // ë©”íƒ€ë°ì´í„° ì €ì¥

while (true) {
  const { value, done } = await reader.read();
  
  if (done) break;
  
  buffer += value;
  const lines = buffer.split('\n');
  buffer = lines.pop() || '';  // ë§ˆì§€ë§‰ ë¶ˆì™„ì „í•œ ì¤„ì€ ë³´ê´€
  
  for (const line of lines) {
    if (!line.trim()) continue;  // ë¹ˆ ì¤„ ë¬´ì‹œ
    
    const message = JSON.parse(line);
    
    if (message.type === 'delta') {
      // í…ìŠ¤íŠ¸ ì²­í¬ â†’ í™”ë©´ì— ë°”ë¡œ í‘œì‹œ
      fullText += message.content;
      updateChatUI(fullText);  // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
      
    } else if (message.type === 'metadata') {
      // ë©”íƒ€ë°ì´í„° â†’ ì €ì¥ (ë‚˜ì¤‘ì— í‘œì‹œ)
      metadata = message.data;
      
    } else if (message.type === 'done') {
      // ì™„ë£Œ â†’ ë©”íƒ€ë°ì´í„° í‘œì‹œ
      if (metadata) {
        displayMetadata(metadata);
      }
      break;
    }
  }
}
```

#### Step 4: UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ì˜ˆì‹œ

```javascript
// ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
function updateChatUI(text) {
  const chatBubble = document.getElementById('chat-response');
  chatBubble.textContent = text;
}

// ë©”íƒ€ë°ì´í„° í‘œì‹œ
function displayMetadata(metadata) {
  if (metadata.rag && metadata.rag.is_regulation) {
    // ê·œì • ì§ˆë¬¸ ë°°ì§€ í‘œì‹œ
    showBadge('ğŸ“š ê·œì • ë¬¸ì„œ ì°¸ì¡°');
    
    // ì°¸ì¡° ë¬¸ì„œ í‘œì‹œ
    if (metadata.rag.document_count > 0) {
      showSourceInfo(`${metadata.rag.document_count}ê°œ ë¬¸ì„œ ì°¸ì¡°`);
    }
  }
  
  // ì›¹ê²€ìƒ‰ ì‚¬ìš© í‘œì‹œ
  if (metadata.web_search_status === 'ok') {
    showBadge('ğŸ” ì›¹ê²€ìƒ‰ ê²°ê³¼ í¬í•¨');
  }
  
  // í•™ì‹ ë©”ë‰´ ì¡°íšŒ í‘œì‹œ
  const cafeteriaFunc = metadata.functions.find(
    f => f.name === 'get_halla_cafeteria_menu'
  );
  if (cafeteriaFunc) {
    showBadge('ğŸ½ï¸ í•™ì‹ ë©”ë‰´ ì¡°íšŒ');
  }
}
```

---

## 5. ì˜ˆì œ ì½”ë“œ

### ì™„ì „í•œ React ì˜ˆì œ

```jsx
import { useState } from 'react';

function ChatBot() {
  const [message, setMessage] = useState('');
  const [response, setResponse] = useState('');
  const [metadata, setMetadata] = useState(null);
  const [isLoading, setIsLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setIsLoading(true);
    setResponse('');
    setMetadata(null);

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          message,
          language: 'KOR'
        })
      });

      const reader = res.body
        .pipeThrough(new TextDecoderStream())
        .getReader();

      let buffer = '';
      let fullText = '';

      while (true) {
        const { value, done } = await reader.read();
        if (done) break;

        buffer += value;
        const lines = buffer.split('\n');
        buffer = lines.pop() || '';

        for (const line of lines) {
          if (!line.trim()) continue;
          
          const msg = JSON.parse(line);

          if (msg.type === 'delta') {
            fullText += msg.content;
            setResponse(fullText);  // ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸
            
          } else if (msg.type === 'metadata') {
            setMetadata(msg.data);
            
          } else if (msg.type === 'done') {
            setIsLoading(false);
          }
        }
      }
    } catch (error) {
      console.error('ìŠ¤íŠ¸ë¦¬ë° ì—ëŸ¬:', error);
      setIsLoading(false);
    }
  };

  return (
    <div>
      <form onSubmit={handleSubmit}>
        <input
          type="text"
          value={message}
          onChange={(e) => setMessage(e.target.value)}
          placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”"
        />
        <button type="submit" disabled={isLoading}>
          ì „ì†¡
        </button>
      </form>

      {/* ë‹µë³€ í‘œì‹œ */}
      <div className="response">
        {response}
      </div>

      {/* ë©”íƒ€ë°ì´í„° í‘œì‹œ */}
      {metadata && (
        <div className="metadata">
          {metadata.rag?.is_regulation && (
            <span className="badge">ğŸ“š ê·œì • ë¬¸ì„œ ì°¸ì¡°</span>
          )}
          {metadata.web_search_status === 'ok' && (
            <span className="badge">ğŸ” ì›¹ê²€ìƒ‰ ê²°ê³¼ í¬í•¨</span>
          )}
          {metadata.functions?.some(f => f.name === 'get_halla_cafeteria_menu') && (
            <span className="badge">ğŸ½ï¸ í•™ì‹ ë©”ë‰´ ì¡°íšŒ</span>
          )}
        </div>
      )}
    </div>
  );
}

export default ChatBot;
```

### ì™„ì „í•œ Vanilla JS ì˜ˆì œ

```html
<!DOCTYPE html>
<html>
<head>
  <title>ì±—ë´‡ í…ŒìŠ¤íŠ¸</title>
  <style>
    .badge {
      background: #e3f2fd;
      padding: 4px 8px;
      border-radius: 4px;
      margin: 4px;
      display: inline-block;
    }
    .response {
      background: #f5f5f5;
      padding: 16px;
      margin: 16px 0;
      border-radius: 8px;
      min-height: 100px;
    }
  </style>
</head>
<body>
  <h1>ì±—ë´‡ ìŠ¤íŠ¸ë¦¬ë° í…ŒìŠ¤íŠ¸</h1>
  
  <form id="chat-form">
    <input type="text" id="message" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”" />
    <button type="submit">ì „ì†¡</button>
  </form>

  <div id="response" class="response"></div>
  <div id="metadata"></div>

  <script>
    document.getElementById('chat-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const message = document.getElementById('message').value;
      const responseDiv = document.getElementById('response');
      const metadataDiv = document.getElementById('metadata');
      
      responseDiv.textContent = '';
      metadataDiv.innerHTML = '';

      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message, language: 'KOR' })
      });

      const reader = res.body.pipeThrough(new TextDecoderStream()).getReader();
      
      let buffer = '';
      let fullText = '';

      while (true) {
        const { value, done } = await reader.read();
        if (done) break;

        buffer += value;
        const lines = buffer.split('\n');
        buffer = lines.pop() || '';

        for (const line of lines) {
          if (!line.trim()) continue;
          
          const msg = JSON.parse(line);

          if (msg.type === 'delta') {
            fullText += msg.content;
            responseDiv.textContent = fullText;
            
          } else if (msg.type === 'metadata') {
            const data = msg.data;
            
            if (data.rag?.is_regulation) {
              metadataDiv.innerHTML += '<span class="badge">ğŸ“š ê·œì • ë¬¸ì„œ ì°¸ì¡°</span>';
            }
            if (data.web_search_status === 'ok') {
              metadataDiv.innerHTML += '<span class="badge">ğŸ” ì›¹ê²€ìƒ‰ ê²°ê³¼ í¬í•¨</span>';
            }
            if (data.functions?.some(f => f.name === 'get_halla_cafeteria_menu')) {
              metadataDiv.innerHTML += '<span class="badge">ğŸ½ï¸ í•™ì‹ ë©”ë‰´ ì¡°íšŒ</span>';
            }
          }
        }
      }
    });
  </script>
</body>
</html>
```

---

## 6. FAQ

### Q1. ì™œ í•œ ì¤„ì— í•˜ë‚˜ì˜ JSON ê°ì²´ì¸ê°€ìš”?

**A**: JSON Lines (NDJSON) í¬ë§·ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
- ìŠ¤íŠ¸ë¦¬ë° í™˜ê²½ì—ì„œ íŒŒì‹±í•˜ê¸° ì‰¬ì›€
- ê° ì¤„ì´ ë…ë¦½ì ì¸ JSON â†’ ë¶€ë¶„ì ìœ¼ë¡œ ì½ì–´ë„ íŒŒì‹± ê°€ëŠ¥
- í‘œì¤€ í¬ë§· (ë§ì€ APIê°€ ì‚¬ìš©)

### Q2. `delta` ë©”ì‹œì§€ê°€ ëë‚¬ëŠ”ì§€ ì–´ë–»ê²Œ ì•Œ ìˆ˜ ìˆë‚˜ìš”?

**A**: `metadata` ë˜ëŠ” `done` ë©”ì‹œì§€ë¥¼ ë°›ìœ¼ë©´ í…ìŠ¤íŠ¸ ìŠ¤íŠ¸ë¦¬ë°ì´ ëë‚œ ê²ƒì…ë‹ˆë‹¤.

**ë©”ì‹œì§€ ìˆœì„œ**:
```
delta â†’ delta â†’ delta â†’ ... â†’ metadata â†’ done
```

### Q3. ë©”íƒ€ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°ë„ ìˆë‚˜ìš”?

**A**: ë„¤, ìˆìŠµë‹ˆë‹¤.
- RAGê°€ ì‚¬ìš©ë˜ì§€ ì•Šì€ ì¼ë°˜ ì§ˆë¬¸ â†’ `rag` í•„ë“œ `null`
- í•¨ìˆ˜ í˜¸ì¶œ ì—†ìŒ â†’ `functions` ë¹ˆ ë°°ì—´ `[]`
- ì›¹ê²€ìƒ‰ ì•ˆ í•¨ â†’ `web_search_status: "not-run"`

**ì˜ˆì‹œ**:
```json
{
  "type": "metadata",
  "data": {
    "rag": null,
    "functions": [],
    "web_search_status": "not-run"
  }
}
```

### Q4. ì—ëŸ¬ ì²˜ë¦¬ëŠ” ì–´ë–»ê²Œ í•˜ë‚˜ìš”?

**A**: HTTP ìƒíƒœ ì½”ë“œì™€ JSON íŒŒì‹± ì—ëŸ¬ë¥¼ í™•ì¸í•˜ì„¸ìš”.

```javascript
try {
  const res = await fetch('/chat', {...});
  
  if (!res.ok) {
    throw new Error(`HTTP ${res.status}: ${res.statusText}`);
  }
  
  // ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬...
  
} catch (error) {
  if (error instanceof SyntaxError) {
    console.error('JSON íŒŒì‹± ì—ëŸ¬:', error);
  } else {
    console.error('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬:', error);
  }
}
```

### Q5. í…ìŠ¤íŠ¸ê°€ UTF-8ë¡œ ê¹¨ì§€ëŠ”ë°ìš”?

**A**: `TextDecoderStream`ì„ ì‚¬ìš©í•˜ì„¸ìš”.

```javascript
// âœ… ì˜¬ë°”ë¥¸ ë°©ë²•
const reader = response.body
  .pipeThrough(new TextDecoderStream())  // UTF-8 ë””ì½”ë”©
  .getReader();

// âŒ ì˜ëª»ëœ ë°©ë²•
const reader = response.body.getReader();  // Uint8Array ë°˜í™˜ (ê¹¨ì§)
```

### Q6. ë””ë²„ê¹… ì‹œ ë¡œê·¸ë¥¼ ë³´ê³  ì‹¶ì–´ìš”

**A**: ê° ë©”ì‹œì§€ë¥¼ ì½˜ì†”ì— ì¶œë ¥í•˜ì„¸ìš”.

```javascript
for (const line of lines) {
  if (!line.trim()) continue;
  
  const msg = JSON.parse(line);
  console.log('[STREAM]', msg.type, msg);  // ë””ë²„ê¹… ë¡œê·¸
  
  // ì²˜ë¦¬ ë¡œì§...
}
```

---

## ğŸ“š ê´€ë ¨ ë¬¸ì„œ

- [ì±—ë´‡ ë¡œì§ ë¶„ë¦¬ ê³„íš (Phase 3)](./ì±—ë´‡_ë¡œì§_ë¶„ë¦¬_ê³„íš.md)
- [RAG ë¶„ë¦¬ ê³„íš (Phase 2)](./RAG_ë¶„ë¦¬_ê³„íš.md)
- [JSON Lines í¬ë§· ëª…ì„¸](https://jsonlines.org/)
- [Fetch API - Streams](https://developer.mozilla.org/en-US/docs/Web/API/Streams_API/Using_readable_streams)

---

## ğŸ”„ ë³€ê²½ ì´ë ¥

| ë‚ ì§œ | ë³€ê²½ ë‚´ìš© |
|------|-----------|
| 2025-10-09 | ì´ˆê¸° ë¬¸ì„œ ì‘ì„± (Phase 2-4 ëŒ€ë¹„) |
